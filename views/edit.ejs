<%- include('partials/header') %>

<div class="container">
    <!-- Messages -->
    <% if (typeof success !== 'undefined' || typeof error !== 'undefined') { %>
        <div class="messages">
            <% if (typeof success !== 'undefined') { %>
                <div class="message success">
                    <i class="fas fa-check-circle"></i>
                    <%= success %>
                </div>
            <% } %>
            <% if (typeof error !== 'undefined') { %>
                <div class="message error">
                    <i class="fas fa-exclamation-circle"></i>
                    <%= error %>
                </div>
            <% } %>
        </div>
    <% } %>

    <div class="edit-post-container">
        <header class="edit-header">
            <nav class="breadcrumb">
                <a href="/">
                    <i class="fas fa-home"></i>
                    Home
                </a>
                <span class="breadcrumb-separator">/</span>
                <a href="/post/<%= post.id %>">
                    <%= post.title %>
                </a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Edit</span>
            </nav>
            
            <h1 class="page-title">
                <i class="fas fa-edit"></i>
                Edit Post
            </h1>
        </header>

        <form class="edit-form" action="/post/<%= post.id %>/edit" method="POST">
            <div class="form-group">
                <label for="title">
                    <i class="fas fa-heading"></i>
                    Title
                </label>
                <input type="text" id="title" name="title" value="<%= post.title %>" required placeholder="Enter post title">
            </div>
            
            <div class="form-group">
                <label for="author">
                    <i class="fas fa-user"></i>
                    Author
                </label>
                <input type="text" id="author" name="author" value="<%= post.author %>" required placeholder="Your name">
            </div>
            
            <div class="form-group">
                <label for="content">
                    <i class="fas fa-edit"></i>
                    Content
                </label>
                <textarea id="content" name="content" required placeholder="Write your post content here..." rows="12"><%= post.content %></textarea>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn-primary">
                    <i class="fas fa-save"></i>
                    Update Post
                </button>
                <a href="/post/<%= post.id %>" class="btn-secondary">
                    <i class="fas fa-times"></i>
                    Cancel
                </a>
                <button type="button" class="btn-danger" onclick="deletePost(<%= post.id %>)">
                    <i class="fas fa-trash"></i>
                    Delete Post
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function deletePost(postId) {
        if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/post/${postId}/delete`;
            document.body.appendChild(form);
            form.submit();
        }
    }

    // Show messages temporarily
    const messages = document.querySelectorAll('.message');
    messages.forEach(message => {
        setTimeout(() => {
            message.style.opacity = '0';
            setTimeout(() => {
                message.remove();
            }, 300);
        }, 5000);
    });

    // Parse URL parameters for messages
    const urlParams = new URLSearchParams(window.location.search);
    const success = urlParams.get('success');
    const error = urlParams.get('error');
    
    if (success || error) {
        // Clean URL after showing message
        setTimeout(() => {
            window.history.replaceState({}, document.title, window.location.pathname);
        }, 1000);
    }

    // Auto-resize textarea
    const textarea = document.getElementById('content');
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
    
    // Initial resize
    textarea.style.height = 'auto';
    textarea.style.height = (textarea.scrollHeight) + 'px';
</script>

<%- include('partials/footer') %>